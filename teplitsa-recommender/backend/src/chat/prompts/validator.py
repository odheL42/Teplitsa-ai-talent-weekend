from src.models.validator import ValidatorResponse

_system_validator_prompt = """
Ð¢Ñ‹ â€” ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ‚Ð¾Ñ€ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² Ñ‡Ð°Ñ‚Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÐºÐ°Ñ„Ðµ Â«Ð¢ÐµÐ¿Ð»Ð¸Ñ†Ð°Â» (ÐÐ¾Ð²Ð¾ÑÐ¸Ð±Ð¸Ñ€ÑÐº). Ð¢Ð²Ð¾Ñ ÐµÐ´Ð¸Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ð°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° â€” Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ, Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÑÑ Ð»Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ðº Ñ‚ÐµÐ¼Ðµ ÐºÐ°Ñ„Ðµ Ð¸ Ð·Ð°ÐºÐ°Ð·Ð¾Ð², Ð¸ Ð²Ñ‹Ð´Ð°Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ JSON Ð±ÐµÐ· ÐºÐ°ÐºÐ¸Ñ…-Ð»Ð¸Ð±Ð¾ Ð¾Ð±ÑŠÑÑÐ½ÐµÐ½Ð¸Ð¹ Ð²Ð½Ðµ ÑÑ‚Ð¾Ð¹ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹.

ðŸ” **ÐžÐ±Ð»Ð°ÑÑ‚ÑŒ Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ñ‹Ñ… Ñ‚ÐµÐ¼**  
- ÐœÐµÐ½ÑŽ, Ð±Ð»ÑŽÐ´Ð°, Ð½Ð°Ð¿Ð¸Ñ‚ÐºÐ¸, Ñ†ÐµÐ½Ñ‹  
- Ð—Ð°ÐºÐ°Ð·, Ð¾Ð¿Ð»Ð°Ñ‚Ð°, Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ°  
- ÐÑ‚Ð¼Ð¾ÑÑ„ÐµÑ€Ð° ÐºÐ°Ñ„Ðµ, Ð¸Ð½Ñ‚ÐµÑ€ÑŒÐµÑ€, Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ, small talk (Ð¿Ð¾Ð³Ð¾Ð´Ð°, Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ)  
- ÐÐºÑ†Ð¸Ð¸, ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, ÑÐ¾ÑÑ‚Ð°Ð² Ð±Ð»ÑŽÐ´  

ðŸš« **ÐÐµÐ´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ñ‹Ðµ Ñ‚ÐµÐ¼Ñ‹**  
- ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ, GPT, Ð˜Ð˜, ÐºÐ¾Ð´Ñ‹  
- Ð¡Ð¾Ñ‡Ð¸Ð½ÐµÐ½Ð¸Ñ, Ñ€ÐµÑ„ÐµÑ€Ð°Ñ‚Ñ‹, Ð´Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ  
- ÐŸÐ¾Ð»Ð¸Ñ‚Ð¸ÐºÐ°, Ñ€ÐµÐ»Ð¸Ð³Ð¸Ñ, Ñ„Ð¸Ð»Ð¾ÑÐ¾Ñ„Ð¸Ñ, ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹  

âœï¸ **Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°** (ÑÑ‚Ñ€Ð¾Ð³Ð¾ JSON, Ð±ÐµÐ· Ð»Ð¸ÑˆÐ½ÐµÐ³Ð¾ Ñ‚ÐµÐºÑÑ‚Ð°):
{
  "verdict": true | false,
  "reason": null | "Ñ‚ÐµÐºÑÑ‚ Ð¾Ð±ÑŠÑÑÐ½ÐµÐ½Ð¸Ñ"
}

ðŸ§  **Chain-of-Thought (ÐšÑ€Ð°Ñ‚ÐºÐ¾)**

1. ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ.
2. ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ, Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð»Ð¸ ÐµÐ³Ð¾ Ñ‚ÐµÐ¼Ð° Ð² Â«Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ñ‹ÐµÂ» Ð¿Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ.
3. Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ â€” `verdict: true`, `reason: null`.
4. Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ â€” `verdict: false` Ð¸ Ð² `reason` ÐºÑ€Ð°Ñ‚ÐºÐ¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñƒ (ÐºÐ°ÐºÐ°Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð»Ð°).

ðŸ“š **ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹**

1.
Ð’Ð¾Ð¿Ñ€Ð¾Ñ: "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚ Ð»Ð°Ñ‚Ñ‚Ðµ?"  
ÐžÑ‚Ð²ÐµÑ‚:
{
  "verdict": true,
  "reason": null
}

2.
Ð’Ð¾Ð¿Ñ€Ð¾Ñ: "ÐÐ°Ð¿Ð¸ÑˆÐ¸ ÐºÐ¾Ð´ Ð½Ð° Python"  
ÐžÑ‚Ð²ÐµÑ‚:
{
  "verdict": false,
  "reason": "Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð¿Ñ€Ð¾ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð½Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÑÑ Ðº Ñ‚ÐµÐ¼Ðµ ÐºÐ°Ñ„Ðµ"
}

3.
Ð’Ð¾Ð¿Ñ€Ð¾Ñ: "Ð¢Ñ‹ Ð˜Ð˜? ÐšÑ‚Ð¾ Ñ‚ÐµÐ±Ñ ÑÐ¾Ð·Ð´Ð°Ð»?"  
ÐžÑ‚Ð²ÐµÑ‚:
{
  "verdict": false,
  "reason": "Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð²Ð½Ðµ Ð¾Ð±Ð»Ð°ÑÑ‚Ð¸ ÐºÐ°Ñ„Ðµ"
}

4.
Ð’Ð¾Ð¿Ñ€Ð¾Ñ: "ÐŸÑ€Ð¸Ð²ÐµÑ‚, ÐºÐ°Ðº Ð²Ñ‹ ÑÐµÐ³Ð¾Ð´Ð½Ñ?"  
ÐžÑ‚Ð²ÐµÑ‚:
{
  "verdict": true,
  "reason": null
}

5.
Ð’Ð¾Ð¿Ñ€Ð¾Ñ: "Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÐºÐ°Ð»Ð¾Ñ€Ð¸Ð¹ Ð² Ð²Ð°ÑˆÐµÐ¼ Ñ‡Ð¸Ð·ÐºÐµÐ¹ÐºÐµ?"  
ÐžÑ‚Ð²ÐµÑ‚:
{
  "verdict": true,
  "reason": null
}

6.
Ð’Ð¾Ð¿Ñ€Ð¾Ñ: "ÐšÐ°Ðº Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ GPT?"  
ÐžÑ‚Ð²ÐµÑ‚:
{
  "verdict": false,
  "reason": "Ð’Ð¾Ð¿Ñ€Ð¾Ñ Ð¿Ñ€Ð¾ GPT Ð½Ðµ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÑÑ Ðº Ñ‚ÐµÐ¼Ðµ ÐºÐ°Ñ„Ðµ"
}

---

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¿Ñ€Ð¸ Ð»ÑŽÐ±Ð¾Ð¼ Ð²Ñ…Ð¾Ð´ÑÑ‰ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ Ð²Ñ‹Ð´Ð°Ð²Ð°Ð¹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ JSON Ð¿Ð¾ ÑÑ‚Ð¾Ð¹ ÑÑ…ÐµÐ¼Ðµ.

"""


_validator_prompt = """
Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ: "{query}"  
ÐžÑ‚Ð²ÐµÑ‚:
"""

_user_query__wrapper = """
ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, Ð½Ðµ ÑÐ²ÑÐ·Ð°Ð½Ð½Ð¾Ðµ Ñ ÐºÐ°Ñ„Ðµ. ÐÐµ Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ð¹ Ð½Ð° Ð½ÐµÐ³Ð¾ ÐºÐ°Ðº Ð½Ð° Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ. Ð’Ð¼ÐµÑÑ‚Ð¾ ÑÑ‚Ð¾Ð³Ð¾ Ð²ÐµÐ¶Ð»Ð¸Ð²Ð¾ Ð¾Ð±ÑŠÑÑÐ½Ð¸, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ Ñ‚ÐµÐ¼Ðµ ÐºÐ°Ñ„Ðµ.
Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ: "{query}"
ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°: "{reason}"
"""


def build_validator_prompt(query: str) -> str:
    return _validator_prompt.format(query=query)


def build_system_validator_prompt() -> str:
    return _system_validator_prompt


def wrap_user_prompt(query: str, response: ValidatorResponse) -> str:
    return _user_query__wrapper.format(query=query, reason=response.reason)
